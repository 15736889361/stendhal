<!doctype html>
<html>
<head>
<title>Stendhal Text Client</title>
<style type="text/css">
body {font-family: "Arial"}
#chat {border: 1px solid #000; padding:0.5em}
#chat p {margin: 0}
p.logerror {color: #F00}
p.logprivmsg {color: #AAA}
</style>

<script src="/json.js"></script>
<script src="/socket.io/socket.io.js"></script>
<!-- <script src="/marauroa-compressed.js"></script> -->
<script type="text/javascript" src="marauroa.js"></script>
<script type="text/javascript" src="client-framework.js"></script>
<script type="text/javascript" src="message-factory.js"></script>
<script type="text/javascript" src="perception.js"></script>
<script type="text/javascript" src="rpobject-factory.js"></script>

<script type="text/javascript" src="stendhal-webui.js"></script>
<script type="text/javascript" src="stendhal-actions.js"></script>
</head>
<body>

<script>

	function send(){
		var val = document.getElementById('chatbar').value;
		var array = val.split(" ");
		if (array[0] == "/choosecharacter") {
			marauroa.clientFramework.chooseCharacter(array[1]);
		} else if (val == '/close') {
			marauroa.clientFramework.close();
		} else {
			var action = {
				"type": "chat",
				"text": val
			};
			marauroa.clientFramework.sendAction(action);
		}
		document.getElementById('chatbar').value = '';
	}

	function esc(msg){
		return msg.replace(/</g, '&lt;').replace(/>/g, '&gt;');
	};

	marauroa.rpobjectFactory._default = function() {
		this.onEvent = function(e) {
			if (e.c == "private_text") {
				stendhal.ui.addChatLogLine(e.a.texttype.toLowerCase(), e.a.text);
			}
		}
	}

	marauroa.clientFramework.onDisconnect = function(reason, error){
		stendhal.ui.addChatLogLine("error", "Disconnected: " + error);
	}
	marauroa.clientFramework.onAvailableCharacterDetails = function(characters) {
		marauroa.clientFramework.chooseCharacter(marauroa.util.first(characters).a.name);
	}

	marauroa.clientFramework.connect(null, null);

</script>

<h1>Sample chat client</h1>
<form id="form" onsubmit="send(); return false">
	<input type="text" name="chatbar" id="chatbar" style="width:90%">
	<input type="submit" value="Send">
</form>
<div id="chat" style="height:200px">
<p>Connecting...</p>
</div>
</body>
</html>